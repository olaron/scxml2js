<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <script src="fsm.js"></script>
    <script>
        window.onload = function() {
            var startTime;
            var updateTimer;
            var update = function(){
                var time = (Date.now() - startTime);
                var h = ("0"+Math.floor(time/3600000)%24).slice(-2);
                var m = ("0"+Math.floor(time/60000)%60).slice(-2);
                var s = ("0"+Math.floor(time/1000)%60).slice(-2);
                var ms = ("0"+time%1000).slice(-3);
                document.getElementById("time").textContent = ""+h+":"+m+":"+s+"."+ms;
            };

            testmachine.connectEvent("Start", function () {
                startTime = Date.now();
                updateTimer = setInterval(update,1);
                document.getElementById("start").textContent = "Stop";
            });
            testmachine.connectEvent("Stop", function () {
                clearInterval(updateTimer);
                document.getElementById("start").textContent = "Reset";
                document.getElementById("pause").textContent = "Pause";
            });
            testmachine.connectEvent("Reset", function () {
                document.getElementById("time").textContent = "00:00:00.000";
                document.getElementById("start").textContent = "Start";
            });
            testmachine.connectEvent("Resume", function () {
                updateTimer = setInterval(update,1);
                document.getElementById("pause").textContent = "Pause";
            });
            testmachine.connectEvent("Pause", function () {
                clearInterval(updateTimer);
                document.getElementById("pause").textContent = "Resume";
            });

            document.getElementById("start").onclick = function () {
                testmachine.submit("BStartStop");
            };
            document.getElementById("pause").onclick = function() {
                testmachine.submit("BPause");
            };
        }
    </script>
</head>
<body>
    <h1 id="time">00:00:00.000</h1>
    <button type="button" id="start">Start</button>
    <button type="button" id="pause">Pause</button>
</body>
</html>